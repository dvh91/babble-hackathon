<div class="topbar">
  <div><img src="assets/babble_white.png" height="27" alt=""></div>
</div>
<div class="babble-title">
  <div class="container row">
    <div class="babble-title-left">
      <h1>{{media?.name}}</h1>
      <div class="characters">
        <img [src]="c.image" class="thumb-circle" *ngFor="let c of state.characters">
        <a href="" class="thumb-circle">+</a>
      </div>
    </div>
    <div class="babble-title-right">
      <div>
        <a (click)="activateLanguage(l)" *ngFor="let l of languages">{{l.language}}</a>
      </div>
      <button (click)="publishBabbles()" [disabled]="state.babbles.length === 0" class="btn btn-primary">Publish</button>
    </div>
  </div>
</div>
<div class="container">
  <div class="action-bar row">
    <div class="tabs">
      <a (click)="filter('*')" class="tab-item active">All transcript</a>
      <a (click)="filter('suggestions')" class="tab-item">12 Suggestions</a>
      <a (click)="filter('babbles')" class="tab-item">{{state.babbles.length}} Babbles</a>
    </div>
    <div class="jump">
      <a href="">Jump to current</a>
    </div>
  </div>

  <div class="main-editor row">
    <div class="transcript" *ngIf="!!getActiveLanguage()">
      <div class="transcript-line" *ngFor="let line of transcript[getActiveLanguage()]">
        <div class="transcript-line-icon">
          <div *ngIf="isCurrentlyPlaying(line.startTime, line.endTime)">
            <img src="assets/waveforms.gif" width="16" alt="">
          </div>
          <a *ngIf="!isCurrentlyPlaying(line.startTime, line.endTime)" class="btn btn-play" (click)="seekTo(line.startTime)"></a>
        </div>
        <div class="transcript-line-times">
          <span (click)="seekTo(line.startTime)">{{srtTimeDisplay(line.startTime)}} - {{srtTimeDisplay(line.endTime)}}</span>
        </div>
        <div class="transcript-line-text">
          <div *ngFor="let singleLine of line.content">
            <span 
              *ngFor="let wordObj of singleLine" 
              (mouseup)="onWordMouseUp($event, wordObj, line.id, singleLine)" 
              (mousedown)="onWordMouseDown($event, wordObj, line.id)"
              class="word"
              [class.selected]="isBabbleSelectedOnWord(selection, wordObj.id, line.id)"
              [class.active]="isBabbleActiveOnWord(wordObj.id, line.id)">
              {{wordObj.word}}
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="video-container">
      <div class="ratio-maker">
        <div class="video-holder" id="kaltura-player"></div>
      </div>
      <div class="debug-block">
        <p class="debug-block-title">DEBUGGING INFO</p>
        <p>currentTime: {{currentTime}}</p>
        <p>selection: {{selection | json}}</p>
        <p>state: {{state | json}}</p>
        <p>languages: {{languages | json}}</p>
      </div>
    </div>
  </div>
</div>

<div [class.active]="popoverActive()" class="babble-popover" #popover>
  <div class="babble-popover-header">
    <img src="http://vignette2.wikia.nocookie.net/lionking/images/0/02/Pumbaa_icons_by_shwz-d3fy8sf.png/revision/latest?cb=20120808023708" class="babble-popover-header-thumb" alt="">
    <p>"{{getSelectionSentence()}}"</p>
  </div>
  <div class="babble-popover-body">
    <a (click)="french()" class="btn">french</a>
    <a (click)="english()" class="btn">english</a>
    <select class="select">
      <option *ngFor="let option of state.characters" value="">{{option.name}}</option>
    </select>
  </div>
  <div class="babble-popover-footer">
    <button [disabled]="false" (click)="addBabble()" class="btn btn-primary">
      Create Babble
    </button>
    <a (click)="cancelPopover()" class="btn btn-link">Cancel</a>
  </div>
</div>